--[[
    VLK Hub (Pro Edition)
    ‚ú¶ By Velkzie ‚ú¶
    Dynamic, Safe, and Easy to Update
]]

local HUB_VERSION = "1.1.0"
local VERSION_URL = "https://raw.githubusercontent.com/YOURUSERNAME/VLKHub/main/version.txt"
local SCRIPTS_URL = "https://raw.githubusercontent.com/YOURUSERNAME/VLKHub/main/scripts.json"

-- Load Rayfield
local success, Rayfield = pcall(function()
    return loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
end)
if not success or not Rayfield then
    warn("[VLK Hub] Failed to load Rayfield!")
    return
end

-- Window
local Window = Rayfield:CreateWindow({
    Name = "VLK Hub",
    Icon = "Home",
    LoadingTitle = "VLK Scripts",
    LoadingSubtitle = "by Velkzie",
    Theme = "Amethyst",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "VLK_Hub",
        FileName = "VLK_Config"
    },
})

-- Notify Function
local function notify(title, text, duration)
    Rayfield:Notify({ Title = title, Content = text, Duration = duration or 3 })
end

-- Safe Script Loader
local function safeLoad(name, url)
    notify("Loading " .. name, "Please wait...", 2)
    task.spawn(function()
        local ok, data = pcall(function()
            return game:HttpGet(url)
        end)
        if not ok or not data or data == "" then
            notify("Error", "Failed to load " .. name .. " ‚Äî invalid or missing link!", 4)
            return
        end
        local runOk, err = pcall(function()
            loadstring(data)()
        end)
        if runOk then
            notify("‚úÖ Loaded " .. name, "Enjoy!", 2)
        else
            notify("‚ùå Script Error", err, 5)
        end
    end)
end

-- Update Checker
local function checkForUpdates()
    task.spawn(function()
        local ok, latest = pcall(function()
            return game:HttpGet(VERSION_URL)
        end)
        if ok and latest and latest ~= HUB_VERSION then
            notify("Update Available!", "Your version: " .. HUB_VERSION .. " | Latest: " .. latest, 5)
        else
            notify("Up to Date", "You're running the latest version!", 3)
        end
    end)
end

-- Load Script List
local scriptsData
local function loadScripts()
    local ok, data = pcall(function()
        return game:HttpGet(SCRIPTS_URL)
    end)
    if ok then
        local decoded = game:GetService("HttpService"):JSONDecode(data)
        if decoded then
            scriptsData = decoded
        end
    else
        notify("Error", "Failed to load script list from server!", 4)
    end
end
loadScripts()

-- Create Tabs Dynamically
if scriptsData then
    for category, scripts in pairs(scriptsData) do
        local tab = Window:CreateTab("üìÇ " .. category)
        for name, url in pairs(scripts) do
            tab:CreateButton({
                Name = name,
                Callback = function()
                    safeLoad(name, url)
                end
            })
        end
    end
end

-- Favorites Tab
local favorites = {}
local FavoritesTab = Window:CreateTab("‚≠ê Favorites")
local function refreshFavoritesTab()
    FavoritesTab:ClearElements()
    for _, fav in ipairs(favorites) do
        FavoritesTab:CreateButton({
            Name = fav.name,
            Callback = function()
                safeLoad(fav.name, fav.url)
            end
        })
    end
end

-- Search Tab
local SearchTab = Window:CreateTab("üîç Search")
SearchTab:CreateInput({
    Name = "Search Script",
    PlaceholderText = "Type script name...",
    RemoveTextAfterFocusLost = false,
    Callback = function(text)
        local found = false
        for category, scripts in pairs(scriptsData) do
            for name, url in pairs(scripts) do
                if string.find(string.lower(name), string.lower(text)) then
                    safeLoad(name, url)
                    found = true
                    break
                end
            end
        end
        if not found then
            notify("No Script Found", "Try another search term", 3)
        end
    end
})

-- Credits Tab
local CreditsTab = Window:CreateTab("üìú Credits")
CreditsTab:CreateLabel("Developed by: Velkzie üíô")
CreditsTab:CreateLabel("Version: " .. HUB_VERSION)
CreditsTab:CreateParagraph({
    Title = "About",
    Content = "VLK Hub is a safe and fun Roblox script hub developed by Velkzie. No NSFW, no malicious code ‚Äî just clean fun."
})
CreditsTab:CreateButton({
    Name = "Check for Updates",
    Callback = checkForUpdates
})

-- Welcome
notify("VLK Hub Pro Loaded!", "Welcome back, Velkzie üíô", 4)
